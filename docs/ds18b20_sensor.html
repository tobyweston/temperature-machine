<html><head><title>Temperature Machine</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Toby Weston" /><meta name="description" content="The homebrew data logger" /><meta name="og:image" content="/img/poster.png" /><meta name="og:title" content="Temperature Machine" /><meta name="og:site_name" content="Temperature Machine" /><meta name="og:url" content="http://temperature-machine.com" /><meta name="og:type" content="website" /><meta name="og:description" content="The homebrew data logger" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="Temperature Machine" /><meta name="twitter:image" content="http://temperature-machine.comimg/poster.png" /><meta name="twitter:description" content="The homebrew data logger" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /><link rel="stylesheet" href="/css/overrides.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-3327317-12' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>Temperature Machine</span></div></a></li> <li><a href="/docs/index.html" class="">Introduction</a></li> <li><a href="/docs/getting_started.html" class="">Getting Started</a> <ul class="sub_section"> <li><a href="/docs/getting_started/installing.html" class="">Installing</a></li> <li><a href="/docs/getting_started/build_from_source.html" class="">Build from Source</a></li> <li><a href="/docs/getting_started/raspbian_setup.html" class="">Raspbian Setup</a></li></ul></li> <li><a href="/docs/getting_help.html" class="">Getting Help</a></li> <li><a href="/docs/ds18b20_sensor.html" class=" active ">DS18B20 Sensor</a></li> <li><a href="/docs/add-on_board.html" class="">Add-on Board</a></li> <li><a href="/docs/rrd.html" class="">RRD</a></li> <li><a href="/docs/hacking.html" class="">Hacking</a> <ul class="sub_section"> <li><a href="/docs/hacking/sbt_plugins.html" class="">SBT Plugins</a></li> <li><a href="/docs/hacking/release.html" class="">Releasing</a></li></ul></li> <li><a href="/docs/ansible.html" class="">Ansible Automation</a> <ul class="sub_section"> <li><a href="/docs/ansible/getting_started.html" class="">Getting Started</a></li> <li><a href="/docs/ansible/useful_commands.html" class="">Useful Ad-hoc Commands</a></li></ul></li> <li><a href="/docs/resources.html" class="">Resources</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/tobyweston/temperature-machine"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/tobyweston/temperature-machine"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Temperature Machine The homebrew data logger');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Temperature Machine The homebrew data logger');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="tobyweston" data-github-repo="temperature-machine"><div class="content-wrapper"><section><h1 id="ds18b20-sensor--1-wire">DS18B20 Sensor &amp; 1-Wire</h1>

<p>The <code class="language-plaintext highlighter-rouge">w1-therm</code> module will output the sensor readings to a file. For example,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4b 01 4b 46 7f ff 05 10 d8 : crc=d8 YES
4b 01 4b 46 7f ff 05 10 d8 t=20687
</code></pre></div></div>

<p>This file is derived from an area of the sensor’s memory called the “scratchpad”. The scratchpad is addressed using the following byte table.</p>

<table>
  <thead>
    <tr>
      <th>Position</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Byte 0</td>
      <td>Temperature (least significant byte)</td>
    </tr>
    <tr>
      <td>Byte 1</td>
      <td>Temperature (most significant byte)</td>
    </tr>
    <tr>
      <td>Byte 2</td>
      <td>TH register on user byte 1 (alarm high)</td>
    </tr>
    <tr>
      <td>Byte 3</td>
      <td>TL register on user byte 2 (alarm low)</td>
    </tr>
    <tr>
      <td>Byte 4</td>
      <td>Configuration register</td>
    </tr>
    <tr>
      <td>Byte 5</td>
      <td>Reserved</td>
    </tr>
    <tr>
      <td>Byte 6</td>
      <td>Reserved</td>
    </tr>
    <tr>
      <td>Byte 7</td>
      <td>Reserved</td>
    </tr>
    <tr>
      <td>Byte 8</td>
      <td>CRC (e.g. <code class="language-plaintext highlighter-rouge">d8</code> in the example above)</td>
    </tr>
  </tbody>
</table>

<p>The file format has some additional information as it pulls out the result of the CRC check (<code class="language-plaintext highlighter-rouge">YES</code>/<code class="language-plaintext highlighter-rouge">NO</code>) and does the temperature calculation for you. If you’re interested, you can calculate the temperature from the bytes yourself by rearranging the first two bytes with least significant at the front;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>01 4b
</code></pre></div></div>

<p>then treating it as a single hex value, divide by <code class="language-plaintext highlighter-rouge">16</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scala&gt; 0x014b / 16.0
res: Double = 20.6875
</code></pre></div></div>

<p>This is how the tempreature-machine software goes about it.</p>

<h3 id="sensor-precision">Sensor Precision</h3>

<p>Byte 4 of the scratchpad is a configuration byte, you can use it to set the conversion resolution; the number of decimal places the temperature will show as. The DS18B20 is supposed to be set at the most accurate (12 bit) at the factory but I’ve had units that were set to record temperatures at 0.5 °C steps (9 bit).</p>

<table>
  <thead>
    <tr>
      <th>Byte 4 Hex</th>
      <th>Precision</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1F</td>
      <td>9 bit</td>
      <td>23.5</td>
    </tr>
    <tr>
      <td>3F</td>
      <td>10 bit</td>
      <td>23.45</td>
    </tr>
    <tr>
      <td>5F</td>
      <td>11 bit</td>
      <td>23.445</td>
    </tr>
    <tr>
      <td>7F</td>
      <td>12 bit</td>
      <td>23.4445</td>
    </tr>
  </tbody>
</table>

<p>So if you see something like this in your scratchpad.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>59 01 4b 01 1f ff 0c 10 39 : crc=39 YES
59 01 4b 01 1f ff 0c 10 39 t=23500
</code></pre></div></div>

<p>the <code class="language-plaintext highlighter-rouge">1f</code> shows the sensor is set to 9 bit resolution.</p>

<p>If your sensor shipped with low resolution you can change it straight from the Pi using <code class="language-plaintext highlighter-rouge">configDS18B20.c</code> from <a href="https://github.com/danjperron/BitBangingDS18B20">Dan Perron</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl https://raw.githubusercontent.com/danjperron/BitBangingDS18B20/master/configDS18B20.c -O
$ gcc -lrt -o configDS18B20 configDS18B20.c
$ sudo ./configDS18B20
</code></pre></div></div>

<p>It’ll output something like the following and prompt you to enter a new resolution.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GPIO 4
BCM GPIO BASE= 20000000
....78 01 4B 46 1F FF 0C 10 FA
09 bits  Temperature:  23.50 +/- 0.500000 Celsius
DS18B20 Resolution (9,10,11 or 12) ?12
Try to set 12 bits  config=7F
</code></pre></div></div>

<p>Now the scratchpad shows the updated value (<code class="language-plaintext highlighter-rouge">7f</code> below)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /sys/bus/w1/devices/28-0115910f5eff/w1_slave
75 01 4b 46 7f ff 7f 10 f5 : crc=f5 YES
75 01 4b 46 7f ff 7f 10 f5 t=23312
</code></pre></div></div>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: 'temperature-machine/Lobby'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/main.js"></script></body></html>